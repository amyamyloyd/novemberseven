---
alwaysApply: false
---
fileType: python
name: python_libraries.mdc
description: Adding Python dependencies to the project
---

# ðŸ“¦ Python Libraries & Dependencies

You are adding a new Python library to the project. Follow these patterns to maintain environment consistency.

---

## Adding New Dependency

### 1. Add to requirements.txt
```bash
# Format: package-name==version
pandas==2.1.0
requests==2.31.0
beautifulsoup4==4.12.2
```

**Always specify version** for reproducibility.

### 2. Install in venv
```bash
source venv/bin/activate  # If not already activated
pip install -r requirements.txt
```

Or install single package:
```bash
pip install package-name==version
```

### 3. Update requirements.txt (if installed individually)
```bash
pip freeze | grep package-name >> requirements.txt
```

Or manually add to `requirements.txt`:
```
package-name==1.2.3
```

---

## Common Libraries (Already Installed)

### Core Framework
- `fastapi==0.104.1` - Web framework
- `uvicorn==0.24.0` - ASGI server
- `sqlalchemy==2.0.23` - ORM
- `pydantic==2.5.0` - Validation

### Authentication
- `python-jose[cryptography]==3.3.0` - JWT
- `passlib[bcrypt]==1.7.4` - Password hashing
- `python-multipart==0.0.6` - Form data

### LangChain & AI
- `langchain==0.1.0` - LLM framework
- `openai==1.3.0` - OpenAI API
- `faiss-cpu==1.7.4` - Vector store
- `tiktoken==0.5.1` - Token counting

### Utilities
- `python-dotenv==1.0.0` - Environment variables
- `pandas==2.1.0` - Data manipulation
- `requests==2.31.0` - HTTP client

---

## Library Selection Guidelines

### Before Adding New Library

1. **Check if already installed**: `pip list | grep package-name`
2. **Check if built-in alternative exists**: Use stdlib when possible
3. **Check package popularity**: PyPI downloads, GitHub stars
4. **Check maintenance**: Last release date, open issues
5. **Document purpose**: Why this library?

### Approved Categories

- **Data processing**: pandas, numpy, openpyxl
- **API clients**: requests, httpx, aiohttp
- **LLM tools**: langchain, openai, anthropic
- **Utilities**: python-dotenv, pydantic, tenacity
- **Testing**: pytest, pytest-asyncio

### Avoid

- Unmaintained packages (no updates in 2+ years)
- Packages with known security issues
- Heavy ML libraries (PyTorch, TensorFlow) - use APIs instead
- Duplicate functionality (pick one HTTP client, not three)

---

## Testing New Library

After installation:

### 1. Test Import
```python
# test_import.py
try:
    import new_package
    print(f"âœ“ {new_package.__name__} version {new_package.__version__}")
except ImportError as e:
    print(f"âœ— Import failed: {e}")
```

### 2. Run in venv
```bash
venv/bin/python test_import.py
```

### 3. Test Deployment
Commit requirements.txt and verify GitHub Actions deployment succeeds.

---

## Common Patterns

### HTTP Requests
```python
import requests

response = requests.get("https://api.example.com/data")
data = response.json()
```

### Environment Variables
```python
import os
from dotenv import load_dotenv

load_dotenv()
api_key = os.getenv("OPENAI_API_KEY")
```

### Data Processing
```python
import pandas as pd

df = pd.read_csv("data.csv")
result = df.groupby("category").sum()
```

### Async HTTP
```python
import httpx

async with httpx.AsyncClient() as client:
    response = await client.get("https://api.example.com")
    data = response.json()
```

---

## Key Rules

1. **Always specify versions** in requirements.txt
2. **Always install in venv** - never system Python
3. **Always test import** after installing
4. **Document why** you're adding the library (comment in requirements.txt)
5. **Never commit venv/** - it's in .gitignore
6. **Update requirements.txt** before committing code that uses new library

---

## Dependency Documentation

Add comments above new dependencies in requirements.txt:

```
# Core framework
fastapi==0.104.1
uvicorn==0.24.0

# Authentication
python-jose[cryptography]==3.3.0

# New dependency for feature X (added 2024-10-22)
beautifulsoup4==4.12.2  # HTML parsing for web scraping
```

---

## Troubleshooting

### Import Error After Install
- Verify venv is activated: `which python`
- Reinstall: `pip install --force-reinstall package-name`
- Check typo in package name

### Dependency Conflict
- Check versions: `pip show package-name`
- Update conflicting package: `pip install --upgrade package-name`
- May need to adjust versions in requirements.txt

### Azure Deployment Fails
- Check GitHub Actions logs for pip install errors
- Common cause: platform-specific packages (use cross-platform alternatives)
- Use `faiss-cpu` not `faiss` (GPU version won't work on Azure)
